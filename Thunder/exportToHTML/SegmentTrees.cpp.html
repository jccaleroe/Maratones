<html>
<head>
<title>SegmentTrees.cpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(128,128,0); }
.s3 { color: rgb(0,128,0); font-weight: bold; }
.s4 { color: rgb(0,0,128); font-weight: bold; }
.s5 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
SegmentTrees.cpp</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">//querys and build takes O(log n)</span><span class="s1"> 
</span><span class="s0">//example with segment sum</span><span class="s1"> 
</span><span class="s2">#include</span><span class="s3">&lt;bits/stdc++.h&gt;</span><span class="s1"> 
 
</span><span class="s4">using namespace </span><span class="s1">std; 
 
</span><span class="s4">int </span><span class="s1">*p; 
 
</span><span class="s4">struct </span><span class="s1">SegmentTree{ 
    SegmentTree *L, *R; 
    </span><span class="s4">int </span><span class="s1">sum = </span><span class="s5">0</span><span class="s1">; 
    </span><span class="s4">int </span><span class="s1">l, r; 
 
    </span><span class="s4">int </span><span class="s1">query(</span><span class="s4">int </span><span class="s1">a, </span><span class="s4">int </span><span class="s1">b){ 
        </span><span class="s4">if</span><span class="s1">(a == l &amp;&amp; b == r) </span><span class="s4">return </span><span class="s1">sum; 
        </span><span class="s4">if</span><span class="s1">(b &lt;= L-&gt;r) </span><span class="s4">return </span><span class="s1">L-&gt;query(a,b); 
        </span><span class="s4">if</span><span class="s1">(a &gt;= R-&gt;l) </span><span class="s4">return </span><span class="s1">R-&gt;query(a,b); 
        </span><span class="s4">return </span><span class="s1">(L-&gt;query(a,L-&gt;r) + R-&gt;query(R-&gt;l, b)); 
    } 
 
    </span><span class="s4">void </span><span class="s1">update(</span><span class="s4">int </span><span class="s1">a, </span><span class="s4">int </span><span class="s1">val){ 
        </span><span class="s4">if</span><span class="s1">(l == r){ 
            sum += val; 
            </span><span class="s4">return</span><span class="s1">; 
        } 
        </span><span class="s4">int </span><span class="s1">mid = (l + r)/</span><span class="s5">2</span><span class="s1">; 
        </span><span class="s4">if</span><span class="s1">(l &lt;= a &amp;&amp; a&lt;= mid) 
            L-&gt;update(a, val); 
        </span><span class="s4">else</span><span class="s1"> 
            R-&gt;update(a, val); 
        sum = L-&gt;sum + R-&gt;sum; 
    } 
 
    </span><span class="s4">void </span><span class="s1">updateRange(</span><span class="s4">int </span><span class="s1">a, </span><span class="s4">int </span><span class="s1">b, </span><span class="s4">int </span><span class="s1">val){ 
        </span><span class="s4">if</span><span class="s1">(b &lt; l </span><span class="s4">or </span><span class="s1">a &gt; r) 
            </span><span class="s4">return</span><span class="s1">; 
        </span><span class="s4">if</span><span class="s1">(l == r){ 
            sum += val; 
            </span><span class="s4">return</span><span class="s1">; 
        } 
        L-&gt;updateRange(a, b, val); 
        R-&gt;updateRange(a,b,val); 
        sum = L-&gt;sum + R-&gt;sum; 
    } 
 
    SegmentTree(</span><span class="s4">int </span><span class="s1">a, </span><span class="s4">int </span><span class="s1">b): l(a), r(b){ 
        </span><span class="s4">if</span><span class="s1">(a == b){ 
            sum = p[a]; 
            </span><span class="s0">//L = R = null;</span><span class="s1"> 
        } 
        </span><span class="s4">else</span><span class="s1">{ 
            L = </span><span class="s4">new </span><span class="s1">SegmentTree ( a, (a+b)/</span><span class="s5">2 </span><span class="s1">); 
            R = </span><span class="s4">new </span><span class="s1">SegmentTree ( (a+b)/</span><span class="s5">2 </span><span class="s1">+ </span><span class="s5">1</span><span class="s1">, b ); 
            sum = L-&gt;sum + R-&gt;sum; 
        } 
    } 
}; 
 
 
 
</span><span class="s4">int </span><span class="s1">main(){ 
    </span><span class="s4">int </span><span class="s1">T; 
    cin &gt;&gt; T; 
 
    </span><span class="s4">int </span><span class="s1">l[T]; 
    </span><span class="s4">for</span><span class="s1">(</span><span class="s4">int </span><span class="s1">i = </span><span class="s5">0</span><span class="s1">; i &lt; T; i++) 
        cin &gt;&gt; l[i]; 
    p = l; 
    SegmentTree *stree = </span><span class="s4">new </span><span class="s1">SegmentTree(</span><span class="s5">0</span><span class="s1">, T); 
    </span><span class="s4">int </span><span class="s1">N; 
    cin &gt;&gt; N; 
    </span><span class="s4">int </span><span class="s1">I; 
    </span><span class="s4">int </span><span class="s1">J; 
    </span><span class="s4">while</span><span class="s1">(N &gt; </span><span class="s5">0</span><span class="s1">){ 
        N -= </span><span class="s5">1</span><span class="s1">; 
        cin &gt;&gt; I; 
        cin &gt;&gt; J; 
        </span><span class="s4">int </span><span class="s1">aux = stree-&gt;query(I-</span><span class="s5">1</span><span class="s1">,J-</span><span class="s5">1</span><span class="s1">); 
        cout &lt;&lt; aux &lt;&lt; </span><span class="s3">&quot;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s1">; 
    } 
} 
</span></pre>
</body>
</html>