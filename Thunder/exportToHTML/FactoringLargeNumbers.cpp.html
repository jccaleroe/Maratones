<html>
<head>
<title>FactoringLargeNumbers.cpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,0); }
.s1 { color: rgb(0,128,0); font-weight: bold; }
.s2 { color: rgb(0,0,0); }
.s3 { color: rgb(0,0,128); font-weight: bold; }
.s4 { color: rgb(0,0,255); }
.s5 { color: rgb(128,128,128); font-style: italic; }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
FactoringLargeNumbers.cpp</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">#include</span><span class="s1">&lt;bits/stdc++.h&gt;</span><span class="s2"> 
</span><span class="s0">#include</span><span class="s1">&lt;time.h&gt;</span><span class="s2"> 
 
</span><span class="s0">#define </span><span class="s2">show(x) cout &lt;&lt; #x &lt;&lt; </span><span class="s1">&quot; = &quot; </span><span class="s2">&lt;&lt; x &lt;&lt; endl; 
 
</span><span class="s3">using namespace </span><span class="s2">std; 
 
</span><span class="s3">typedef long long </span><span class="s2">ll; 
</span><span class="s3">typedef </span><span class="s2">pair&lt;ll, ll&gt; ii; 
</span><span class="s3">typedef </span><span class="s2">pair&lt;</span><span class="s3">double</span><span class="s2">, ii&gt; iii; 
 
</span><span class="s3">const int </span><span class="s2">MAX = </span><span class="s4">200005</span><span class="s2">; 
</span><span class="s3">const double </span><span class="s2">EPS = </span><span class="s4">1e-5</span><span class="s2">; 
</span><span class="s3">const int </span><span class="s2">INF = INT_MAX; 
 
ll mul(ll a, ll b, ll mod) { 
    ll ret = </span><span class="s4">0</span><span class="s2">; 
    </span><span class="s3">for</span><span class="s2">(a %= mod, b %= mod; b != </span><span class="s4">0</span><span class="s2">; 
        b &gt;&gt;= </span><span class="s4">1</span><span class="s2">, a &lt;&lt;= </span><span class="s4">1</span><span class="s2">, a = a &gt;= mod ? a - mod : a) { 
        </span><span class="s3">if </span><span class="s2">(b&amp;</span><span class="s4">1</span><span class="s2">) { 
            ret += a; 
            </span><span class="s3">if </span><span class="s2">(ret &gt;= mod) ret -= mod; 
        } 
    } 
    </span><span class="s3">return </span><span class="s2">ret; 
} 
 
ll fpow(ll a, ll b, ll MOD) { 
    ll ans = </span><span class="s4">1LL</span><span class="s2">; 
    </span><span class="s3">while</span><span class="s2">(b &gt; </span><span class="s4">0</span><span class="s2">) { 
        </span><span class="s3">if</span><span class="s2">(b&amp;</span><span class="s4">1</span><span class="s2">) ans = mul(ans, a, MOD); 
        a = mul(a, a, MOD); 
        b &gt;&gt;= </span><span class="s4">1LL</span><span class="s2">; 
    } 
    </span><span class="s3">return </span><span class="s2">ans; 
} 
 
</span><span class="s3">const int </span><span class="s2">rounds = </span><span class="s4">6</span><span class="s2">; 
</span><span class="s5">// Checks if a number is prime with prob 1 - 1 / (2 ^ it)</span><span class="s2"> 
</span><span class="s3">bool </span><span class="s2">miller_rabin(ll n) { 
    </span><span class="s3">if</span><span class="s2">(n == </span><span class="s4">2 </span><span class="s2">|| n == </span><span class="s4">3</span><span class="s2">) </span><span class="s3">return true</span><span class="s2">; 
    </span><span class="s3">if</span><span class="s2">(n &lt; </span><span class="s4">2 </span><span class="s2">|| (n&amp;</span><span class="s4">1</span><span class="s2">) == </span><span class="s4">0</span><span class="s2">) </span><span class="s3">return false</span><span class="s2">; 
    </span><span class="s3">for</span><span class="s2">(</span><span class="s3">int </span><span class="s2">i = </span><span class="s4">0</span><span class="s2">; i &lt; rounds; i++) { 
        </span><span class="s3">int </span><span class="s2">a = rand()%(n-</span><span class="s4">4</span><span class="s2">)+</span><span class="s4">2</span><span class="s2">; 
        </span><span class="s3">if</span><span class="s2">(fpow(a, n-</span><span class="s4">1</span><span class="s2">, n) != </span><span class="s4">1</span><span class="s2">) 
            </span><span class="s3">return false</span><span class="s2">; 
    } 
    </span><span class="s3">return true</span><span class="s2">; 
} 
 
</span><span class="s5">// if n is prime , check with miller rabin (n^(1/4)) and check return != n and  != 1</span><span class="s2"> 
ll pollard_rho(ll n, ll c) { 
    ll x = </span><span class="s4">2</span><span class="s2">, y = </span><span class="s4">2</span><span class="s2">, i = </span><span class="s4">1</span><span class="s2">, k = </span><span class="s4">2</span><span class="s2">, d; 
    </span><span class="s3">while </span><span class="s2">(</span><span class="s3">true</span><span class="s2">) { 
        x = (mul(x, x, n) + c); 
        </span><span class="s3">if </span><span class="s2">(x &gt;= n) x -= n; 
        d = __gcd(x - y, n); 
        </span><span class="s3">if </span><span class="s2">(d &gt; </span><span class="s4">1</span><span class="s2">) </span><span class="s3">return </span><span class="s2">d; 
        </span><span class="s3">if </span><span class="s2">(++i == k) y = x, k &lt;&lt;= </span><span class="s4">1</span><span class="s2">; 
    } 
    </span><span class="s3">return </span><span class="s2">n; 
} 
 
</span><span class="s3">void </span><span class="s2">factorize(ll n, vector&lt;ll&gt; &amp;f) { 
    </span><span class="s3">if</span><span class="s2">(n == </span><span class="s4">1</span><span class="s2">) </span><span class="s3">return</span><span class="s2">; 
    </span><span class="s3">if </span><span class="s2">(miller_rabin(n)) { 
        f.push_back(n); 
        </span><span class="s3">return</span><span class="s2">; 
    } 
    ll d = n; 
    </span><span class="s3">for </span><span class="s2">(</span><span class="s3">int </span><span class="s2">i = </span><span class="s4">2</span><span class="s2">; d == n; i++) 
        d = pollard_rho(n, i); 
    factorize(d, f); 
    factorize(n/d, f); 
} 
 
</span><span class="s3">int </span><span class="s2">main() { 
    ios_base::sync_with_stdio(</span><span class="s4">0</span><span class="s2">); 
    cin.tie(</span><span class="s4">0</span><span class="s2">); 
 
    </span><span class="s0">#ifdef </span><span class="s2">FSOCIETY 
        freopen(</span><span class="s1">&quot;input.txt&quot;</span><span class="s2">, </span><span class="s1">&quot;r&quot;</span><span class="s2">, stdin); 
        freopen(</span><span class="s1">&quot;output.txt&quot;</span><span class="s2">, </span><span class="s1">&quot;w&quot;</span><span class="s2">, stdout); 
    </span><span class="s0">#endif </span><span class="s5">// FSOCIETY</span><span class="s2"> 
 
</span><span class="s5">//    srand(time(0));</span><span class="s2"> 
 
    ll n; 
    </span><span class="s3">while</span><span class="s2">(cin &gt;&gt; n &amp;&amp; n != -</span><span class="s4">1</span><span class="s2">) { 
        vector&lt;ll&gt; ans; 
        factorize(n, ans); 
        sort(ans.begin(), ans.end()); 
        </span><span class="s3">for</span><span class="s2">(</span><span class="s3">int </span><span class="s2">i = </span><span class="s4">0</span><span class="s2">; i &lt; ans.size(); i++) { 
            cout &lt;&lt; </span><span class="s1">&quot;    &quot; </span><span class="s2">&lt;&lt; ans[i] &lt;&lt; </span><span class="s1">&quot;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s2">; 
        } 
        cout &lt;&lt; </span><span class="s1">&quot;</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s2">; 
    } 
} 
</span></pre>
</body>
</html>